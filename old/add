function doGet(e) {
  console.log('üéØ doGet –í–´–ó–í–ê–ù –í –ù–û–í–û–ú –°–ö–†–ò–ü–¢–ï');
  
  try {
    // –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ —á—Ç–æ –ø—Ä–∏—à–ª–æ
    console.log('üì• –ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç e:', JSON.stringify(e));
    
    if (!e || !e.parameter) {
      console.log('‚ùå –ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ e –∏–ª–∏ e.parameter');
      return createResponse(false, 'No parameters received: ' + JSON.stringify(e));
    }
    
    const params = e.parameter;
    console.log('üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:', params);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É
    const rowData = [
      new Date().toISOString(),
      params.user_id || '–ù–µ —É–∫–∞–∑–∞–Ω',
      params.username || '–ù–µ —É–∫–∞–∑–∞–Ω',
      params.city || '–ù–µ —É–∫–∞–∑–∞–Ω',
      params.children || '–ù–µ —É–∫–∞–∑–∞–Ω',
      params.source || 'GET Request'
    ];
    
    console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ:', rowData);
    
    const SPREADSHEET_ID = '1zCboXVlUWnfhYiv7qQUbz-gHxuCkQ-dGO8551f8crC0';
    const SHEET_NAME = 'user_profiles';
    
    const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
    let sheet = spreadsheet.getSheetByName(SHEET_NAME);
    
    sheet.appendRow(rowData);
    const rowNumber = sheet.getLastRow();
    
    console.log('‚úÖ –î–ê–ù–ù–´–ï –°–û–•–†–ê–ù–ï–ù–´ –≤ —Å—Ç—Ä–æ–∫—É:', rowNumber);
    
    return createResponse(true, '–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ' + params.username + ' —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Å—Ç—Ä–æ–∫—É ' + rowNumber, {
      row: rowNumber,
      user: params.username
    });
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    return createResponse(false, error.toString());
  }
}

function doPost(e) {
  console.log('‚ö†Ô∏è doPost –≤—ã–∑–≤–∞–Ω - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ doGet');
  return doGet(e);
}

function createResponse(success, message, additionalData = {}) {
  const response = {
    success: success,
    message: message,
    timestamp: new Date().toISOString(),
    ...additionalData
  };
  
  console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç:', response);
  
  return ContentService
    .createTextOutput(JSON.stringify(response))
    .setMimeType(ContentService.MimeType.JSON);
}

// –¢–ï–°–¢ - –í–´–ü–û–õ–ù–ò –≠–¢–£ –§–£–ù–ö–¶–ò–Æ!
function testNewScript() {
  console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç...');
  
  const mockEvent = {
    parameter: {
      user_id: 'test_new_script',
      username: '—Ç–µ—Å—Ç_–Ω–æ–≤—ã–π_—Å–∫—Ä–∏–ø—Ç',
      city: '–¢–µ—Å—Ç–æ–≤—ã–π –≥–æ—Ä–æ–¥',
      children: '1 —Ä–µ–±–µ–Ω–æ–∫',
      source: 'Test'
    }
  };
  
  const result = doGet(mockEvent);
  const content = result.getContent();
  console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', content);
  
  return '–¢–µ—Å—Ç –Ω–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω!';
}
